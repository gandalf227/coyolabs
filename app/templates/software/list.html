{% extends "layouts/student_base.html" %}
{% set crumbs = [("Inicio", url_for('inventory.inventory_list')), ("Software", url_for('software.list_software'))] %}
{% block title %}Software{% endblock %}
{% block content %}
<h1>Catálogo de software</h1>
<form method="get" action="/software/" class="input-grid">
  <div><label>Filtrar por laboratorio</label><select name="lab_id"><option value="">-- Todos --</option>{% for lab in labs %}<option value="{{ lab.id }}" {% if selected_lab == lab.id %}selected{% endif %}>{{ lab.name }}</option>{% endfor %}</select></div>
  <div><label>&nbsp;</label><button type="submit">Filtrar</button></div>
</form>
{% if items|length == 0 %}<p>No hay software registrado.</p>{% else %}
<div class="table-wrap"><table><thead><tr><th>ID</th><th>Lab</th><th>Nombre</th><th>Versión</th><th>Licencia</th><th>Notas</th><th>Update</th><th>Acciones</th></tr></thead><tbody>
{% for s in items %}<tr><td>{{ s.id }}</td><td>{% if s.lab %}{{ s.lab.name }}{% else %}-{% endif %}</td><td>{{ s.name }}</td><td>{{ s.version }}</td><td>{{ s.license_type }}</td><td>{{ s.notes }}</td><td>{% if s.update_requested %}<span class="badge warn">SOLICITADO</span><br>{{ s.update_note }}{% else %}-{% endif %}</td><td><form method="post" action="/software/{{ s.id }}/request-update"><input type="text" name="update_note" placeholder="motivo (opcional)"><button type="submit">Solicitar update</button></form>{% if current_user.role in ['ADMIN', 'SUPERADMIN'] %}<form method="post" action="/software/admin/{{ s.id }}/clear-update"><button type="submit">Resolver (Admin)</button></form>{% endif %}</td></tr>{% endfor %}
</tbody></table></div>{% endif %}
{% endblock %}
